worker_processes  3;
#error_log         /etc/nginx/logs/error.log;
#pid               /var/run/nginx.pid;

events {
   worker_connections  10240;
}


http {
        #sendfile                on;
        #include       mime.types;

        log_format  main
              'remote_addr:$remote_addr\t'
              'time_local:$time_local\t'
              'method:$request_method\t'
              'uri:$request_uri\t'
              'host:$host\t'
              'hostdest:$remote_addr\t'
              'status:$status\t'
              'bytes_sent:$body_bytes_sent\t'
              'referer:$http_referer\t'
              'useragent:$http_user_agent\t'
              'forwardedfor:$http_x_forwarded_for\t'
              'request_time:$request_time';


        access_log      /var/log/nginx/access.log main;


         server {
              listen 80 default_server;

              location /auth/ {
                  proxy_pass            http://auth-service.default.svc.cluster.local:8080/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /chat/ {
                  proxy_pass            http://chat-service.default.svc.cluster.local:8080/chat/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /news/ {
                  proxy_pass            http://news-service.default.svc.cluster.local:8080/news/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /storage/ {
                  proxy_pass            http://storage-service.default.svc.cluster.local:8080/storage/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /notification/ {
                  proxy_pass            http://notification-service.default.svc.cluster.local:8080/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /socket/ {
                  proxy_pass            http://socket-service.default.svc.cluster.local:8080/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /up/ {
                  proxy_pass            http://up-service.default.svc.cluster.local:8080/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

              location /login/ {
                  proxy_pass            http://auth-service.default.svc.cluster.local:8080/auth/pages/login.html;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_cache_bypass    $http_upgrade;
                  proxy_set_header Cookie $http_cookie;
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }


              location /test/ {
                  proxy_pass            http://uol-service:8080/;

                  proxy_http_version 1.1;
                  proxy_set_header      Upgrade $http_upgrade;
                  proxy_set_header      Connection 'upgrade';
                  proxy_pass_request_headers      on;
                  proxy_set_header X-Forwarded-Port $server_port;
              }

        }


}
